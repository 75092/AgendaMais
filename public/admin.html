<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8"/>
  <title>Administração</title>
  <link href="style.css" rel="stylesheet"/>
  <style>
    .tab-submenu button {
      margin: 5px;
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      background: #2b7cff;
      color: white;
      cursor: pointer;
    }
    .tab-submenu button.active {
      background: #195ecb;
    }
    .noticia-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
<div class="header">
  <img alt="Logotipo ULSAS" class="logo" src="/ulsas_logotipo.png"/>
</div>
<div class="sidebar">
  <ul>
    <li><a href="index.html">Início</a></li>
    <li><a href="agendamentos.html">Agendamentos</a></li>
    <li><a href="calendario.html">Calendário</a></li>
    <li><a href="salas.html">Salas</a></li>
    <li><a href="admin.html">Administração</a></li>
  </ul>
</div>
<div class="main-content">
  <h1>Administração</h1>
  <div class="tabs">
    <button class="tab-button" data-tab="definicoes">Definições</button>
  </div>
  <div class="tab-content active" id="definicoes">
    <div class="tab-submenu">
      <button class="submenu-button active" data-subtab="ocupacao">Taxa de Ocupação</button>
      <button class="submenu-button" data-subtab="noticias">Gestão de Notícias</button>
    </div>
    <div class="subtab-content active" id="ocupacao">
      <h2>Taxa de Ocupação de Espaços ULSAS</h2>
      <p>[Aqui fica a lógica existente da taxa de ocupação]</p>
    </div>
    <div class="subtab-content" id="noticias" style="display:none;">
      <h2>Gestão de Notícias</h2>
      <form id="form-noticia">
        <label>Título:<br><input type="text" id="titulo"></label><br><br>
        <label>Conteúdo:<br><textarea id="conteudo"></textarea></label><br><br>
        <button type="submit">Adicionar Notícia</button>
      </form>
      <div id="lista-noticias"></div>
    </div>
  </div>
</div>
<script>
document.querySelectorAll('.submenu-button').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.submenu-button').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.subtab-content').forEach(c => c.style.display = 'none');
    btn.classList.add('active');
    document.getElementById(btn.dataset.subtab).style.display = 'block';
  });
});

const form = document.getElementById('form-noticia');
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const titulo = document.getElementById('titulo').value;
  const conteudo = document.getElementById('conteudo').value;
  const token = localStorage.getItem('token');
  const res = await fetch('noticias.php', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + token },
    body: new URLSearchParams({ titulo, conteudo })
  });
  const txt = await res.text();
  alert(txt);
  carregarNoticias();
});

async function carregarNoticias() {
  const res = await fetch('noticias.json');
  if (!res.ok) return;
  const noticias = await res.json();
  const lista = document.getElementById('lista-noticias');
  lista.innerHTML = '';
  noticias.forEach((n, i) => {
    const div = document.createElement('div');
    div.className = 'noticia-card';
    div.innerHTML = `<strong>${n.titulo}</strong><br><small>${n.data}</small><p>${n.conteudo}</p>
      <button onclick="removerNoticia(${i})">Remover</button>`;
    lista.appendChild(div);
  });
}

async function removerNoticia(i) {
  const token = localStorage.getItem('token');
  const res = await fetch('noticias.php', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + token },
    body: new URLSearchParams({ remover: i })
  });
  const txt = await res.text();
  alert(txt);
  carregarNoticias();
}

carregarNoticias();
</script>
</body>
</html>
