
<!DOCTYPE html>
<html lang='pt'>
<head>
    <meta charset='UTF-8'>
    <title>Novo Agendamento</title>
    <style>
        body { display: flex; margin: 0; font-family: Arial, sans-serif; }
        .sidebar {
            width: 250px;
            background-color: #f0f0f0;
            padding: 20px;
            position: fixed;
            top: 0; left: 0; bottom: 0;
            z-index: 2;
        }
        .main-content {
            margin-left: 250px;
            padding: 20px;
            flex-grow: 1;
            z-index: 1;
        }
        #confirmacao {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class='sidebar'>
        <h3>Menu</h3>
        <ul>
            <li><a href='index.html'>Início</a></li>
            <li><a href='agendamentos.html'>Agendamentos</a></li>
            <li><a href='calendario.html'>Calendário</a></li>
            <li><a href='salas.html'>Salas</a></li>
            <li><a href='admin.html'>Administração</a></li>
        </ul>
    </div>
    <div class='main-content'>
        <h2>Formulário de Agendamento</h2>
        <form id='formAgendamento'>
            <label>Número Mecanográfico:</label><input type='text' id='mecanografico'><br>
            <label>Nome:</label><input type='text' id='nome'><br>
            <label>Serviço:</label><input type='text' id='servico'><br>
            <label>Email:</label><input type='email' id='email'><br>
            <label>Telefone/Telemóvel:</label><input type='text' id='telefone'><br>
            <label>Data:</label><input type='date' id='data'><br>
            <label>Hora de Início:</label><input type='time' id='horaInicio'><br>
            <label>Hora de Fim:</label><input type='time' id='horaFim'><br>
            <label>Sala Pretendida:</label>
            <select id='sala'>
                <option>-- Selecione --</option>
                <option>Sala Tejo</option>
                <option>Sala Almada</option>
                <option>Sala Formação</option>
            </select><br>
            <label>Nome do Evento:</label><input type='text' id='evento'><br>
            <label>N.º de Participantes:</label><input type='number' id='participantes'><br>
            <label>Observações:</label><textarea id='observacoes'></textarea><br>
            <button type='submit' id='btnSubmeter'>Submeter Agendamento</button>
        </form>
        <div id='confirmacao'>✅ Olá, o agendamento foi confirmado!</div>
    </div>
    <script>
        document.querySelector("#formAgendamento").addEventListener("submit", function(e) {
            e.preventDefault();
            const dados = {
                nome: document.querySelector("#nome").value,
                sala: document.querySelector("#sala").value,
                evento: document.querySelector("#evento").value,
                horaInicio: document.querySelector("#horaInicio").value,
                horaFim: document.querySelector("#horaFim").value,
                data: document.querySelector("#data").value
            };
            fetch("/api/agendar", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dados)
            }).then(res => {
                if (res.ok) {
                    document.getElementById("confirmacao").style.display = "block";
                    setTimeout(() => document.getElementById("confirmacao").style.display = "none", 3000);
                }
            });
        });

        function atualizarSalasDisponiveis() {
            const data = document.querySelector("#data").value;
            const inicio = document.querySelector("#horaInicio").value;
            const fim = document.querySelector("#horaFim").value;
            fetch(`/api/salas-disponiveis?data=${data}&inicio=${inicio}&fim=${fim}`)
                .then(res => res.json())
                .then(salas => {
                    const select = document.querySelector("#sala");
                    select.innerHTML = "<option>-- Selecione --</option>";
                    salas.forEach(sala => {
                        select.innerHTML += `<option value='${sala.id}'>${sala.nome}</option>`;
                    });
                });
        }
        document.querySelector("#data").addEventListener("change", atualizarSalasDisponiveis);
        document.querySelector("#horaInicio").addEventListener("change", atualizarSalasDisponiveis);
        document.querySelector("#horaFim").addEventListener("change", atualizarSalasDisponiveis);
    </script>
</body>
</html>
